\ProvidesPackage{codespace}

% Need python Pygments and --shell-escape flag
\RequirePackage[dvipsnames]{xcolor}
\RequirePackage{tikz}
\RequirePackage[framemethod=tikz]{mdframed}
\RequirePackage{minted,verbatim}
\RequirePackage[linesnumbered,lined,boxed,commentsnumbered]{algorithm2e}

\usemintedstyle{emacs}

\newcommand{\@codeframe}{
  backgroundcolor=magenta!10,
  leftline=false,
  rightline=false,
  nobreak=false
}
\newcommand{\ocodeframe}[1]{\renewcommand{\@codeframe}{#1}}

\newcommand{\@codestyle}{
  linenos=true,
  autogobble=true,
  breaklines=true,
  breaksymbolleft={},
  firstnumber=1,
  obeytabs=true,
  tabsize=2
}
\newcommand{\ocodestyle}[1]{\renewcommand{\@codestyle}{#1}}

\newenvironment{code}[2][]{
  \VerbatimEnvironment%
  \edef\xmdframed{\noexpand\begin{mdframed}[\@codeframe]}\xmdframed%
    \edef\xminted{\noexpand\begin{minted}[\@codestyle,#1]{#2}}\xminted%
}{
    \end{minted}%
  \end{mdframed}%
}

\newcommand{\inputcode}[3][]{
  \edef\xmdframed{\noexpand\begin{mdframed}[\@codeframe]}\xmdframed%
    \edef\xinputminted{\noexpand\inputminted[\@codestyle,#1]{#2}{#3}}\xinputminted%
  \end{mdframed}%
}
